# ES 2021 æ–°ç‰¹æ€§æå‰çŸ¥
ES2021 çš„æ–°ç‰¹æ€§æ¦‚è§ˆï¼š
- String.prototype.replaceAll
- Promise.any
- WeakRef
- è¾‘èµ‹å€¼è¿ç®—ç¬¦
- æ•°å­—åˆ†éš”ç¬¦


## String.protype.replaceAll
æ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰æŒ‡å®šçš„å­—ç¬¦
```js
const fruits = 'ğŸ+ğŸ+ğŸ“+';
const fruitsWithBanana = fruits.replace(/\+/g, 'ğŸŒ');
console.log(fruitsWithBanana); //ğŸğŸŒğŸğŸŒğŸ“ğŸŒ
```

```js
// ES2021
const fruits = 'ğŸ+ğŸ+ğŸ“+';
const fruitsWithBanana = fruits.replaceAll('+', 'ğŸŒ');
console.log(fruitsWithBanana); //ğŸğŸŒğŸğŸŒğŸ“ğŸŒ
```

## Promise.any
`Promise.any` æ–¹æ³•å’Œ `Promise.race` ç±»ä¼¼â€”â€”åªè¦ç»™å®šçš„è¿­ä»£ä¸­çš„ä¸€ä¸ª `promise` æˆåŠŸï¼Œå°±é‡‡ç”¨ç¬¬ä¸€ä¸ª `promise` çš„å€¼ä½œä¸ºå®ƒçš„è¿”å›å€¼ï¼Œä½†ä¸` Promise.race` çš„ä¸åŒä¹‹å¤„åœ¨äºâ€”â€”å®ƒä¼šç­‰åˆ°æ‰€æœ‰ `promise` éƒ½å¤±è´¥ä¹‹åï¼Œæ‰è¿”å›å¤±è´¥çš„å€¼ï¼š
```js
const myFetch = url => setTimeout(() => fetch(url), Math.floor(Math.random() * 3000));
const promises = [
    myFetch('/endpoint-1'),
    myFetch('/endpoint-2'),
    myFetch('/endpoint-3'),
];
// ä½¿ç”¨ .then .catch
Promise.any(promises) // ä»»ä½•ä¸€ä¸ª promise æˆåŠŸã€‚
       .then(console.log) // æ¯”å¦‚ â€˜3â€™
       .catch(console.error); // æ‰€æœ‰çš„ promise éƒ½å¤±è´¥äº†
// ä½¿ç”¨ async-await
try {
  const first = await Promise.any(promises); // ä»»ä½•ä¸€ä¸ª promise æˆåŠŸè¿”å›ã€‚
 console.log(first);
}catch (error) { // æ‰€æœ‰çš„ promise éƒ½å¤±è´¥äº†
  console.log(error);
}
```

## WeakRef
`WeakRef` ææ¡ˆä¸»è¦åŒ…å«ä¸¤ä¸ªæ–°åŠŸèƒ½ï¼š
- å¯ä»¥é€šè¿‡ `WeakRef` ç±»æ¥ç»™æŸä¸ªå¯¹è±¡åˆ›å»ºä¸€ä¸ªå¼±å¼•ç”¨
- å¯ä»¥é€šè¿‡ `FinalizationRegistry` ç±»ï¼Œåœ¨æŸä¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶ä¹‹åï¼Œæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰æ–¹æ³•

`WeakRef` ä¸»è¦ç”¨æ¥ `ç¼“å­˜` å’Œ `æ˜ å°„` ä¸€äº›å¤§å‹å¯¹è±¡ï¼Œå½“ä½ å¸Œæœ›æŸä¸ªå¯¹è±¡åœ¨ä¸è¢«å…¶å®ƒåœ°æ–¹å¼•ç”¨çš„æƒ…å†µä¸‹åŠæ—¶åœ°è¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥ä½¿ç”¨å®ƒã€‚
```js
function toogle(element) {
    const weakElement = new WeakRef(element);
    let intervalId = null;

    function toggle() {
        const el = weakElement.deref();
        if (!el) {
            return clearInterval(intervalId);
        }
        const decoration = weakElement.style.textDecoration;
        const style= decoration === 'none' ? 'underline' : 'none';
        decoration = style;
    }
    intervalId = setInterval(toggle, 1000);
}
const element = document.getElementById("link");
toogle(element);
setTimeout(() => element.remove(), 10000);
```

## é€»è¾‘èµ‹å€¼è¿ç®—ç¬¦
é€»è¾‘èµ‹å€¼è¿ç®—ç¬¦ç»“åˆäº† é€»è¾‘è¿ç®—ç¬¦ å’Œ èµ‹å€¼è¡¨è¾¾å¼ã€‚é€»è¾‘èµ‹å€¼è¿ç®—ç¬¦æœ‰ä¸¤ç§ï¼š
- æˆ–ç­‰äºï¼ˆ||=ï¼‰
- ä¸”ç­‰äºï¼ˆ&&=ï¼‰
```js
// æˆ–ç­‰äº
|   a   |   b   | a ||= b | a (è¿ç®—å) |
| true  | true  |   true  |        true         |
| true  | false |   true  |        true         |
| false | true  |   true  |        true         |
| false | false |   false |        false        |
a ||= b
// ç­‰åŒäº:
a || (a = b);

// ä¸”ç­‰äº
|   a   |   b   | a &&= b | a (è¿ç®—å) |
| true  | true  |   true  |        true         |
| true  | false |   false |        false        |
| false | true  |   false |        false        |
| false | false |   false |        false        |
a &&= b
// ç­‰åŒäº:
a && (a = b);
```

## æ•°å­—åˆ†éš”ç¬¦
é€šè¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬åˆ©ç”¨ â€œï¼ˆ_ï¼ŒU+005Fï¼‰â€ åˆ†éš”ç¬¦æ¥å°†æ•°å­—åˆ†ç»„ï¼Œæé«˜æ•°å­—çš„å¯è¯»æ€§ï¼š
```js
1_000_000_000           // åäº¿
101_475_938.38          // äº¿ä¸‡

const amount = 12345_00;  // 12,345
const amount = 123_4500;  // 123.45 (ä¿ç•™ 4 ä½å°æ•°)
const amount = 1_234_500; // 1,234,500

0.000_001 // ç™¾ä¸‡åˆ†ä¹‹ä¸€
1e10_000  // 10^10000

const binary_literals = 0b1010_0001_1000_0101;
const hex_literals = 0xA0_B0_C0;
const bigInt_literals = 1_000_000_000_000n;
const octal_literal = 0o1234_5670;
```

[å‚è€ƒæ–‡çŒ®](https://mp.weixin.qq.com/s/qsqjiJokazH_06x3ugcplg)







